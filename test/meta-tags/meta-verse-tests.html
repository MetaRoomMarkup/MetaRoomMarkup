<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <script src="../../bower_components/webcomponentsjs/webcomponents.min.js"></script>
  <script src="../../bower_components/web-component-tester/browser.js"></script>

  <script src='../spec.js'></script>

  <link rel="import" href="../../dist/metaroom-markup.html">

</head>
<body>

  <div id='fixture'>
    <meta-verse id="meta-verse"></meta-verse>
  </div>
  <script>
    describe('<meta-verse>', function() {
      beforeEach(function(){
        jlet('metaVerse', function(){ return document.querySelector("#meta-verse") });
      });

      it('got a gameObject', function() {
        expect(J.metaVerse.controller).to.have.property("gameObject");
      });

      it('appends a canvas', function(){
        expect(J.metaVerse.querySelector("canvas#hpml-webgl-canvas")).not.to.be.null;
      });

      describe("events", function(){
        describe("when meta-style is attached", function(){

          it("concat the globalMetaStyle", function(){

            J.metaVerse.dispatchEvent(new CustomEvent('meta-attached', {
              detail: {
                controller: {
                  tagName: 'meta-style',
                  metaStyle: [
                    {
                      selector: ['.picture-2'],
                      declarations: [
                        {
                          "property": "mesh-color",
                          "value": 'blue'
                        }
                      ]
                    }
                  ]
                }
              }
            }));

            J.metaVerse.dispatchEvent(new CustomEvent('meta-attached', {
              detail: {
                controller: {
                  tagName: 'meta-style',
                  metaStyle: [
                    {
                      selector: ['.picture-1'],
                      declarations: [
                        {
                          "property": "mesh-color",
                          "value": 'red'
                        }
                      ]
                    }
                  ]
                }
              }
            }));

            expect(J.metaVerse.controller.globalMetaStyle[".picture-1"]).to.deep.equal({"mesh-color": "red"})
            expect(J.metaVerse.controller.globalMetaStyle[".picture-2"]).to.deep.equal({"mesh-color": "blue"})

          });

        });
      });

    });
  </script>
</body>
</html>
